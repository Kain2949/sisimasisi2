<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Raf game</title>

  <link rel="preconnect" href="https://telegram.org" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <link rel="stylesheet" href="style.css" />
</head>
<body class="booting">
  <div id="app">
    <div class="stage" id="stage">
      <!-- –õ–µ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞: —Ñ–æ–Ω + —Ç–µ–∫—Å—Ç -->
      <div class="pane">
        <div class="card glass glass--panel" id="desc">
          <span class="glass__lens" aria-hidden="true"></span>
          <img id="bgImg" alt="" />
          <div class="text"><span id="descText">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</span></div>

          <!-- HUD -->
          <div class="hudbar glass glass--hud">
            <div class="timer" id="timer">00:00</div>
            <button id="menuBtn" class="hud-menu glass glass--btn" aria-label="–ú–µ–Ω—é" title="–ú–µ–Ω—é">‚â°</button>
          </div>
        </div>
      </div>

      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –≤–∞—Ä–∏–∞–Ω—Ç—ã -->
      <div class="pane">
        <div class="card glass glass--panel">
          <span class="glass__lens" aria-hidden="true"></span>
          <div class="stack" id="options"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div id="boot" class="boot" aria-live="polite">
    <div class="boot-box glass glass--panel">
      <span class="glass__lens" aria-hidden="true"></span>
      <div class="boot-title">–ì–æ—Ç–æ–≤–ª—é —Ñ–æ–Ω‚Ä¶</div>
      <div class="boot-progress"><div id="bootBar"></div></div>
      <div class="boot-meta">
        <span id="bootPct">0%</span><span>¬∑</span><span id="bootCount">0/0</span>
      </div>
    </div>
  </div>

  <!-- ¬´–í–µ–∫–∏¬ª -->
  <div class="eyelid top" id="eyelidTop"></div>
  <div class="eyelid bot" id="eyelidBot"></div>

  <!-- –î–∏–∞–ª–æ–≥–∏ -->
  <dialog id="invDlg" class="glass glass--panel">
    <span class="glass__lens" aria-hidden="true"></span>
    <button class="close glass glass--btn" id="invClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
    <div class="dlg-body">
      <h3>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
      <div id="invList" class="list"></div>
    </div>
  </dialog>

  <dialog id="flagsDlg" class="glass glass--panel">
    <span class="glass__lens" aria-hidden="true"></span>
    <button class="close glass glass--btn" id="flagsClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
    <div class="dlg-body">
      <h3>–§–ª–∞–≥–∏</h3>
      <div id="flagsList" class="list"></div>
    </div>
  </dialog>

  <!-- –ì–õ–ê–í–ù–û–ï –û–í–ï–†–õ–ï–ô -->
  <div id="overlay" class="overlay hidden">
    <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
    <div id="menuPanel" class="panel main glass glass--panel hidden">
      <span class="glass__lens" aria-hidden="true"></span>

      <!-- –í–∏–Ω—Ç–∞–∂–Ω–∞—è –≤—ã–≤–µ—Å–∫–∞ Raf Game -->
      <div class="marquee">
        <svg id="rafLogo" viewBox="0 0 1000 230" aria-label="Raf Game">
          <defs>
            <filter id="bulbGlow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="2.2" result="g1"/>
              <feMerge>
                <feMergeNode in="g1"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
            <radialGradient id="bulbRad" cx="50%" cy="50%" r="60%">
              <stop offset="0%"  stop-color="#fff4d0"/>
              <stop offset="38%" stop-color="#ffd79a"/>
              <stop offset="100%" stop-color="#f2a44a"/>
            </radialGradient>
          </defs>

          <g transform="translate(0,8)">
            <g class="letter" data-letter="R" transform="translate(90,40) rotate(-6)">
              <path class="metal" d="M0,0 L0,140 L38,140 L38,88 L72,88 C96,88 116,68 116,44 C116,20 96,0 72,0 Z M38,36 L38,52 L66,52 C73,52 80,46 80,44 C80,40 74,36 66,36 Z M38,88 L90,140 L120,140 L68,88 Z"/>
              <g class="bulbs" data-points="R"></g>
            </g>
            <g class="letter" data-letter="A" transform="translate(230,38) rotate(-4)">
              <path class="metal" d="M60,0 L0,140 L34,140 L46,112 L74,112 L86,140 L120,140 L60,0 Z M56,86 L64,66 L72,86 Z"/>
              <g class="bulbs" data-points="A"></g>
            </g>
            <g class="letter" data-letter="F" transform="translate(360,40) rotate(-2)">
              <path class="metal" d="M0,0 L0,140 L112,140 L112,110 L34,110 L34,84 L94,84 L94,54 L34,54 L34,0 Z"/>
              <g class="bulbs" data-points="F"></g>
            </g>
            <g class="letter" data-letter="G" transform="translate(510,28) rotate(2)">
              <path class="metal" d="M72,0 C32,0 0,32 0,72 C0,112 32,144 72,144 C106,144 134,124 144,94 L114,94 C108,106 90,116 72,116 C50,116 32,98 32,76 C32,54 50,36 72,36 C92,36 108,46 112,58 L72,58 L72,86 L152,86 L152,74 C152,32 114,0 72,0 Z"/>
              <g class="bulbs" data-points="G"></g>
            </g>
            <g class="letter" data-letter="A" transform="translate(680,38) rotate(3)">
              <path class="metal" d="M60,0 L0,140 L34,140 L46,112 L74,112 L86,140 L120,140 L60,0 Z M56,86 L64,66 L72,86 Z"/>
              <g class="bulbs" data-points="A"></g>
            </g>
            <g class="letter" data-letter="M" transform="translate(810,40) rotate(5)">
              <path class="metal" d="M0,140 L0,0 L30,0 L60,78 L90,0 L120,0 L120,140 L90,140 L90,62 L66,120 L54,120 L30,62 L30,140 Z"/>
              <g class="bulbs" data-points="M"></g>
            </g>
            <g class="letter" data-letter="E" transform="translate(950,40) rotate(8)">
              <path class="metal" d="M0,0 L0,140 L116,140 L116,110 L34,110 L34,84 L100,84 L100,54 L34,54 L34,30 L116,30 L116,0 Z"/>
              <g class="bulbs" data-points="E"></g>
            </g>
          </g>
        </svg>
      </div>

      <div class="menu-col">
        <button id="btnStart" class="cta glass glass--btn">–ù–∞—á–∞—Ç—å</button>
        <button id="btnContinue" class="cta glass glass--btn ghost">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
      <div class="menu-bottom">
        <button id="btnLeaderboard" class="round glass glass--btn" title="–õ–∏–¥–µ—Ä–±–æ—Ä–¥">üèÜ</button>
        <button id="btnSettings" class="round glass glass--btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
      </div>
    </div>

    <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
    <div id="regPanel" class="panel glass glass--panel hidden">
      <span class="glass__lens" aria-hidden="true"></span>
      <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
      <div class="form">
        <label>–ù–∏–∫–Ω–µ–π–º
          <input id="regNick" class="glass glass--input" type="text" maxlength="24" placeholder="—Ç–≤–æ–π –Ω–∏–∫" />
        </label>
        <label>–¢–µ–≥ –≤ Telegram (—Å @)
          <input id="regTag" class="glass glass--input" type="text" maxlength="32" placeholder="@kain2949" />
        </label>
        <label>–ü–æ–ª</label>
        <div class="pill-row">
          <button id="btnMale"   type="button" class="pill glass glass--btn active">–ú—É–∂—Å–∫–æ–π</button>
          <button id="btnFemale" type="button" class="pill glass glass--btn">–ñ–µ–Ω—Å–∫–∏–π</button>
        </div>
        <div class="dual">
          <button id="btnSendCode" class="btn glass glass--btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</button>
          <input id="regCode" class="glass glass--input" type="text" inputmode="numeric" maxlength="6" placeholder="–∫–æ–¥ –∏–∑ –±–æ—Ç–∞" />
          <button id="btnVerify" class="btn quiet glass glass--btn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        </div>
        <div id="regMsg" class="muted">–ü–æ–ª –∂–µ–Ω—Å–∫–∏–π ‚Äî –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω –Ω–∞–≤—Å–µ–≥–¥–∞.</div>
      </div>
    </div>

    <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ -->
    <div id="lbPanel" class="panel glass glass--panel hidden">
      <span class="glass__lens" aria-hidden="true"></span>
      <h2>–õ–∏–¥–µ—Ä–±–æ—Ä–¥</h2>
      <div class="lb-list" id="lbList"></div>
      <div style="margin-top:12px; display:flex; justify-content:flex-end;">
        <button class="btn quiet glass glass--btn" id="lbBack">–ù–∞–∑–∞–¥</button>
      </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div id="settingsPanel" class="panel glass glass--panel hidden">
      <span class="glass__lens" aria-hidden="true"></span>
      <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      <div class="settings">
        <label class="row">
          <span>–≠—Ñ—Ñ–µ–∫—Ç—ã-–ø–æ–º–µ—Ö–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ü–µ–Ω</span>
          <input id="fxEnable" type="checkbox" checked />
        </label>
        <label class="row">
          <span>–®–∞–Ω—Å –ø–æ—è–≤–ª–µ–Ω–∏—è –ø–æ–º–µ—Ö</span>
          <input id="fxChance" type="range" min="0" max="100" step="1" value="50" />
          <span id="fxChanceVal" class="val">50%</span>
        </label>
        <div style="display:flex; justify-content:flex-end; margin-top:12px;">
          <button id="settingsBack" class="btn glass glass--btn quiet">–ì–æ—Ç–æ–≤–æ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- –í–ù–£–¢–†–ï–ù–ù–ï–ï –ú–ï–ù–Æ -->
  <div id="ingameOverlay" class="overlay hidden">
    <div class="panel small glass glass--panel">
      <span class="glass__lens" aria-hidden="true"></span>
      <button class="close close-fixed glass glass--btn" id="gmClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      <div class="vstack">
        <button id="gmInventory" class="btn glass glass--btn">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
        <button id="gmFlags" class="btn glass glass--btn">–§–ª–∞–≥–∏</button>
        <button id="gmSaveExit" class="btn glass glass--btn warn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏ –≤ –º–µ–Ω—é</button>
      </div>
    </div>
  </div>

  <!-- ================= SVG-—Ñ–∏–ª—å—Ç—Ä LQG (—Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –ª–∏–Ω–∑–∞) ================ -->
  <svg class="fx-defs" width="0" height="0" aria-hidden="true">
    <defs>
      <!-- ¬´–ª–∏–Ω–∑–∞¬ª: –º—è–≥–∫–∞—è —Ä–µ—Ñ—Ä–∞–∫—Ü–∏—è, –±–µ–∑ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ —Ç–µ–∫—Å—Ç–∞ -->
      <filter id="glass-distortion" x="-20%" y="-20%" width="140%" height="140%" filterUnits="objectBoundingBox">
        <!-- —à—É–º –¥–ª—è –º–∏–∫—Ä–æ–≤–æ–ª–Ω (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å—Ç–∞—Ç–∏—á–µ–Ω) -->
        <feTurbulence id="lqgNoise" type="fractalNoise" baseFrequency="0.006 0.008" numOctaves="2" seed="7" result="noise"/>
        <feGaussianBlur in="noise" stdDeviation="2" result="softNoise"/>
        <!-- –∫–∞—Ä—Ç–∞ —Å–º–µ—â–µ–Ω–∏—è (X –∏–∑ R, Y –∏–∑ B) -->
        <feComponentTransfer in="softNoise" result="map">
          <feFuncR type="gamma" amplitude="1" exponent="10" offset="0.5"/>
          <feFuncG type="gamma" amplitude="0" exponent="1" offset="0"/>
          <feFuncB type="gamma" amplitude="1" exponent="10" offset="0.5"/>
        </feComponentTransfer>
        <!-- –ª—ë–≥–∫–∏–π specular ‚Äî –±–ª–∏–∫ –Ω–∞ –∏–∑–≥–∏–±–µ -->
        <feSpecularLighting in="map" surfaceScale="5" specularConstant="0.9" specularExponent="60" lighting-color="#ffffff" result="spec">
          <fePointLight x="-220" y="-180" z="260"/>
        </feSpecularLighting>
        <feComposite in="spec" operator="arithmetic" k2="1" k3="1" result="lit"/>
        <!-- —Å–º–µ—â–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ–≥–æ —Å–ª–æ—è –ª–∏–Ω–∑—ã -->
        <feDisplacementMap in="SourceGraphic" in2="map" scale="60" xChannelSelector="R" yChannelSelector="B"/>
      </filter>
    </defs>
  </svg>

  <!-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–∞–º–ø –≤ –≤—ã–≤–µ—Å–∫–µ + –ø–µ—Ä–µ–≥–æ—Ä–∞–Ω–∏–µ -->
  <script>
  (function(){
    const svg = document.getElementById('rafLogo');
    if(!svg) return;
    const patterns = {
      R: [...Array.from({length:7},(_,i)=>[8,8+i*18]), ...Array.from({length:5},(_,i)=>[18+i*14,10]),
          ...Array.from({length:6},(_,i)=>[74+Math.cos(-Math.PI/2+i*0.35)*26, 34+Math.sin(-Math.PI/2+i*0.35)*22]),
          ...Array.from({length:3},(_,i)=>[40+i*12,88]), ...Array.from({length:5},(_,i)=>[58+i*12,96+i*9])],
      A: [...Array.from({length:7},(_,i)=>[16,20+i*16]), ...Array.from({length:7},(_,i)=>[104,20+i*16]),
          [60,8],[48,28],[72,28], ...Array.from({length:5},(_,i)=>[44+i*20,86])],
      F: [...Array.from({length:8},(_,i)=>[10,8+i*16]), ...Array.from({length:6},(_,i)=>[20+i*16,12]), ...Array.from({length:6},(_,i)=>[20+i*16,56])],
      G: [...Array.from({length:12},(_,i)=>[72+Math.cos(i/12*2*Math.PI)*40, 72+Math.sin(i/12*2*Math.PI)*34]), [112,72],[120,72],[128,72]],
      M: [...Array.from({length:8},(_,i)=>[12,12+i*16]), ...Array.from({length:8},(_,i)=>[108,12+i*16]), [40,12],[60,52],[80,12],[60,80]],
      E: [...Array.from({length:8},(_,i)=>[12,8+i*16]), ...Array.from({length:6},(_,i)=>[22+i*16,12]),
          ...Array.from({length:6},(_,i)=>[22+i*16,56]), ...Array.from({length:6},(_,i)=>[22+i*16,108])]
    };
    svg.querySelectorAll('.letter .bulbs').forEach(g=>{
      const pts = patterns[g.getAttribute('data-points')] || [];
      pts.forEach(([x,y])=>{
        const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
        c.setAttribute('cx',x); c.setAttribute('cy',y); c.setAttribute('r',6.5);
        c.setAttribute('class','bulb on');
        g.appendChild(c);
      });
    });
    const bulbs = Array.from(svg.querySelectorAll('.bulb'));
    setInterval(()=>{
      bulbs.forEach(b=>{
        if(b.classList.contains('dead')) return;
        if(Math.random()<0.05){
          b.classList.add('dead');
          setTimeout(()=>b.classList.remove('dead'), 1000*(1+Math.floor(Math.random()*5)));
        }
      });
    },1000);

    // –µ—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å ¬´–∂–∏–≤–æ—Å—Ç—å¬ª —Å—Ç–µ–∫–ª–∞ ‚Äî —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π –Ω–∏–∂–µ (—Å–µ–π—á–∞—Å OFF)
    const turb = document.getElementById('lqgNoise');
    let t=0; (function loop(){ t+=0.012; const f1=0.006+Math.sin(t*.7)*0.0025; const f2=0.008+Math.cos(t*.9)*0.0025;
    turb.setAttribute('baseFrequency', `${f1} ${f2}`); requestAnimationFrame(loop); })();
  })();
  </script>

  <script src="app.js"></script>
</body>
</html>
